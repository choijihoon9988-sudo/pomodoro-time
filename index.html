<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friction-Zero | 마찰 제로</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link id="favicon" rel="icon" href="icons/favicon-default.png" type="image/png">
</head>
<body>
    <div id="app-container">
        <main id="app-view" class="view">
            <header class="app-header">
                <div class="app-header__title">
                    <h1>Friction-Zero</h1>
                    <div class="gamification-stats">
                        <span>🔥 연속 집중 <span id="streak-count">0</span>일</span>
                        <span class="separator">|</span>
                        <span>레벨 <span id="user-level">1</span></span>
                    </div>
                </div>
            </header>

            <section class="focus-dashboard">
                <div class="timer-container">
                    <div class="timer-progress">
                        <svg class="timer-progress__svg" viewBox="0 0 120 120">
                            <circle class="timer-progress__background" cx="60" cy="60" r="54"></circle>
                            <circle class="timer-progress__goal" cx="60" cy="60" r="54" transform="rotate(-90 60 60)"></circle>
                            <circle class="timer-progress__time" cx="60" cy="60" r="54" transform="rotate(-90 60 60)"></circle>
                        </svg>
                        <div class="timer-display">
                            <p id="timer-mode" class="timer-display__mode">집중 시간</p>
                            <p id="timer-clock" class="timer-display__time">25:00</p>
                            <div id="rest-suggestion-container" class="hidden">
                                <p id="rest-suggestion-text"></p>
                            </div>
                        </div>
                    </div>
                    <div class="timer-controls">
                        <button id="start-btn" class="button button--primary button--large">집중하기</button>
                        <button id="pause-btn" class="button button--secondary button--large hidden">잠시 멈춤</button>
                        <button id="reset-btn" class="button">초기화</button>
                    </div>
                </div>

                <div class="dashboard-widgets">
                    <!-- '성장의 숲' 위젯: 기존 '오늘의 에너지'와 '오늘 완료한 집중' 위젯을 통합 -->
                    <div class="widget" id="forest-widget">
                        <div class="widget__header">
                            <h3 class="widget__title">🌳 성장의 숲</h3>
                            <div id="daily-goal-container" class="daily-goal">
                                <input type="number" id="daily-goal-input" min="1" value="8">
                                <span>씨앗</span>
                                <button id="set-goal-btn" class="button button--small">목표 설정</button>
                            </div>
                        </div>
                        <!-- 오늘의 씨앗/새싹 현황판 -->
                        <div id="seeds-display" class="widget__content">
                            <!-- JS가 씨앗/새싹 아이콘을 여기에 렌더링합니다. -->
                        </div>
                        <div class="widget__divider"></div>
                        <!-- 누적 성장 요약 -->
                        <div class="forest-summary">
                            <p>지금까지 총 <strong id="total-trees-count">0</strong>그루의 나무를 심었어요.</p>
                            <div id="forest-dormant-message" class="hidden">
                                <p>오랫동안 숲을 돌보지 않아 잠들어 있어요. 집중해서 숲을 깨워주세요!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <footer class="app-footer">
                <details class="settings-panel">
                    <summary class="settings-panel__toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2.82l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2.82l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        <span>집중/휴식 설정</span>
                    </summary>
                    <div class="settings-panel__content">
                        <h4>집중 관리 프리셋</h4>
                        <div class="settings__presets">
                            <button class="button button--preset" data-condition="최상" data-focus="50" data-rest="10">최상</button>
                            <button class="button button--preset" data-condition="좋음" data-focus="30" data-rest="5">좋음</button>
                            <button class="button button--preset active" data-condition="보통" data-focus="25" data-rest="5">보통</button>
                            <button class="button button--preset" data-condition="나쁨" data-focus="25" data-rest="10">나쁨</button>
                        </div>
                        <div class="settings__divider"></div>
                        <h4>휴식 관리</h4>
                        <div class="settings__sound">
                            <label for="alarm-sound-select">종료 알람음</label>
                            <select id="alarm-sound-select"></select>
                        </div>
                        <div class="settings__toggle">
                            <label for="enhanced-rest-toggle">휴식 중 가이드 표시</label>
                            <input type="checkbox" id="enhanced-rest-toggle" class="toggle-switch">
                        </div>
                         <div id="sound-therapy-container" class="settings__sound hidden">
                            <label for="rest-sound-select">휴식 배경음</label>
                            <select id="rest-sound-select"></select>
                        </div>
                    </div>
                </details>
                <div class="main-actions">
                    <button id="stats-btn" class="button button--secondary">성장 리포트 보기</button>
                    <button id="my-systems-btn" class="button button--secondary">나의 성장 규칙</button>
                    <button id="end-day-btn" class="button button--primary">하루 마무리</button>
                </div>
            </footer>
        </main>
    </div>

    <div id="modal-layer">
        <div id="log-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="log-modal-title">
            <div class="modal__overlay" data-close-modal></div>
            <div class="modal__content text-left">
                <button class="modal__close-btn" aria-label="Close dialog" data-close-modal>&times;</button>
                <h2 id="log-modal-title">방금 어떠셨나요?</h2>
                <form id="log-form">
                    <div class="form-field">
                        <label for="log-activity">무엇에 집중하셨나요?</label>
                        <textarea id="log-activity" rows="3" required></textarea>
                    </div>
                    <div class="form-field">
                        <label>방해 요인이 있었나요?</label>
                        <div id="friction-tags" class="tag-group"></div>
                    </div>
                     <div class="form-field">
                        <label>어떤 감정을 느꼈나요?</label>
                        <div id="emotion-tags" class="tag-group"></div>
                    </div>
                    <div class="form-field">
                        <label for="distraction-input">떠오른 생각은 여기에 잠시 맡겨두세요.</label>
                        <input type="text" id="distraction-input" placeholder="예: 저녁 장보기">
                        <ul id="distraction-list"></ul>
                    </div>
                    <button type="submit" class="button button--primary button--full">기록하고 휴식하기</button>
                </form>
            </div>
        </div>

        <div id="report-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="report-modal-title">
            <div class="modal__overlay" data-close-modal></div>
            <div class="modal__content">
                <button class="modal__close-btn" aria-label="Close dialog" data-close-modal>&times;</button>
                <h2 id="report-modal-title">오늘 하루 리포트</h2>
                <div id="report-content" class="text-left"></div>
                <button id="show-system-btn" class="button button--primary hidden button--full">해결 방법 만들기</button>
            </div>
        </div>
        
        <div id="stats-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="stats-modal-title">
            <div class="modal__overlay" data-close-modal></div>
            <div class="modal__content text-left">
                <button class="modal__close-btn" aria-label="Close dialog" data-close-modal>&times;</button>
                <div class="stats-header">
                    <h2 id="stats-modal-title">성장 리포트</h2>
                    <select id="stats-period-select">
                        <option value="7">최근 7일</option>
                        <option value="30">최근 30일</option>
                    </select>
                </div>
                <div id="stats-content">
                    <!-- '나의 숲' 시각화가 여기에 렌더링됩니다. -->
                    <div id="my-forest-visualization"></div>
                    
                    <div class="widget__divider"></div>
                    
                    <!-- 시간대별 마찰 분석 차트가 여기에 렌더링됩니다. -->
                    <div id="friction-by-time-chart-container" class="report__stat">
                        <p class="report__title">시간대별 방해 요인 발생 빈도</p>
                        <canvas id="frictionByTimeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div id="system-suggestion-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="system-modal-title">
            <div class="modal__overlay" data-close-modal></div>
            <div class="modal__content">
                <button class="modal__close-btn" aria-label="Close dialog" data-close-modal>&times;</button>
                <h2 id="system-modal-title">나만의 해결 규칙 제안</h2>
                <p id="system-suggestion-text"></p>
                <button id="adopt-system-btn" class="button button--primary button--full">이 규칙 추가하기</button>
            </div>
        </div>
        
        <div id="my-systems-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="my-systems-title">
            <div class="modal__overlay" data-close-modal></div>
            <div class="modal__content">
                <button class="modal__close-btn" aria-label="Close dialog" data-close-modal>&times;</button>
                <h2 id="my-systems-title">나의 성장 규칙</h2>
                <div id="my-systems-list"></div>
            </div>
        </div>

        <div id="session-transition-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="transition-title">
            <div class="modal__overlay"></div>
            <div class="modal__content">
                <p id="transition-icon" class="modal__icon">☕</p>
                <h2 id="transition-title">고생하셨어요! 잠시 휴식 시간입니다</h2>
                <p id="transition-message" class="modal__message">5분간 재충전하며 다음 집중을 준비하세요.</p>
                <button id="transition-action-btn" class="button button--secondary">휴식하기</button>
            </div>
        </div>
        
        <div id="reset-confirm-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="reset-confirm-title">
            <div class="modal__overlay" data-close-modal></div>
            <div class="modal__content">
                <h2 id="reset-confirm-title">정말 초기화하시겠어요?</h2>
                <p>지금 세션을 초기화하면, 지금까지 집중한 시간은 기록되지 않아요. 괜찮으신가요?</p>
                <div class="modal__actions">
                    <button id="cancel-reset-btn" class="button button--secondary" data-close-modal>취소</button>
                    <button id="confirm-reset-btn" class="button button--danger">네, 초기화할게요</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="positive-priming">
        <p id="positive-priming-text"></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-sankey@0.11.0/dist/chartjs-chart-sankey.min.js"></script>
    <script type="module" src="script.js?v=4"></script> 
</body>
</html>

